<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YourCoverAI - Professional AI Cover Letter Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            brand: {
              50: '#f0fdfa',
              100: '#ccfbf1',
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a',
              950: '#042f2e',
            },
            dark: {
              900: '#0f172a',
              800: '#1e293b',
              700: '#334155',
            }
          },
          animation: {
            'blob': 'blob 7s infinite',
            'fade-in': 'fadeIn 0.5s ease-out forwards',
          },
          keyframes: {
            blob: {
              '0%': { transform: 'translate(0px, 0px) scale(1)' },
              '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
              '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
              '100%': { transform: 'translate(0px, 0px) scale(1)' },
            },
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #0f172a;
      /* Slate 900 */
      color: #f8fafc;
    }

    .glass {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .glass-hover:hover {
      background: rgba(30, 41, 59, 0.8);
      border-color: rgba(255, 255, 255, 0.15);
    }

    .gradient-text {
      background: linear-gradient(135deg, #2dd4bf 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .glow {
      box-shadow: 0 0 20px rgba(45, 212, 191, 0.15);
    }

    .glow:focus-within {
      box-shadow: 0 0 30px rgba(45, 212, 191, 0.25);
      border-color: rgba(45, 212, 191, 0.5);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #0f172a;
    }

    ::-webkit-scrollbar-thumb {
      background: #334155;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #475569;
    }
  </style>
</head>

<body class="antialiased min-h-screen relative overflow-x-hidden selection:bg-brand-500 selection:text-white">

  <!-- Background Gradients -->
  <div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
    <div
      class="absolute top-0 left-1/4 w-96 h-96 bg-brand-500/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob">
    </div>
    <div
      class="absolute top-0 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob animation-delay-2000">
    </div>
    <div
      class="absolute -bottom-32 left-1/3 w-96 h-96 bg-blue-500/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob animation-delay-4000">
    </div>
  </div>

  <!-- Navbar -->
  <nav class="fixed w-full z-50 top-0 transition-all duration-300 glass border-b-0 border-b-white/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-2">
          <div
            class="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-400 to-purple-500 flex items-center justify-center text-white font-bold text-lg shadow-lg">
            Y</div>
          <span class="text-xl font-bold tracking-tight text-white">YourCover<span
              class="text-brand-400">AI</span></span>
        </div>
        <div class="flex items-center gap-4">
          <a href="#pricing"
            class="hidden sm:block text-sm font-medium text-slate-300 hover:text-white transition-colors">Pricing</a>

          <!-- Language Dropdown -->
          <div class="relative group">
            <button id="langBtn"
              class="flex items-center gap-2 px-3 py-1.5 rounded-full glass hover:bg-white/10 transition-all text-sm font-medium text-slate-200">
              <span id="langBtnText">EN</span>
              <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div id="langDropdown"
              class="absolute right-0 mt-2 w-40 glass rounded-xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right z-50 overflow-hidden">
              <div class="py-1">
                <button
                  class="lang-option w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-white/10 hover:text-white transition-colors"
                  data-lang="en">English</button>
                <button
                  class="lang-option w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-white/10 hover:text-white transition-colors"
                  data-lang="zh">中文</button>
                <button
                  class="lang-option w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-white/10 hover:text-white transition-colors"
                  data-lang="es">Español</button>
                <button
                  class="lang-option w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-white/10 hover:text-white transition-colors"
                  data-lang="fr">Français</button>
                <button
                  class="lang-option w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-white/10 hover:text-white transition-colors"
                  data-lang="de">Deutsch</button>
                <button
                  class="lang-option w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-white/10 hover:text-white transition-colors"
                  data-lang="ja">日本語</button>
              </div>
            </div>
          </div>

          <a href="#pricing"
            class="px-5 py-2 rounded-full bg-white text-slate-900 text-sm font-semibold hover:bg-brand-50 transition-colors shadow-lg shadow-brand-500/20">
            Get Pro
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="relative z-10 pt-28 pb-20 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">

    <!-- Hero Section -->
    <div class="text-center mb-16 animate-fade-in">
      <div
        class="inline-flex items-center gap-2 px-3 py-1 rounded-full glass border border-brand-500/30 text-brand-300 text-xs font-medium mb-6">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-brand-500"></span>
        </span>
        AI-Powered Career Assistant
      </div>
      <h1 class="text-4xl md:text-6xl font-bold tracking-tight mb-6">
        Craft the Perfect <br class="hidden md:block" />
        <span class="gradient-text">Cover Letter in Seconds</span>
      </h1>
      <p class="text-lg text-slate-400 max-w-2xl mx-auto mb-8">
        Stop staring at a blank page. Let our advanced AI analyze your job description and write a professional,
        personalized cover letter that gets you hired.
      </p>
    </div>

    <!-- App Interface -->
    <div class="grid lg:grid-cols-2 gap-8 items-start">

      <!-- Input Panel -->
      <div class="glass rounded-2xl p-1 shadow-2xl glow transition-all duration-300 animate-fade-in"
        style="animation-delay: 0.1s;">
        <div class="bg-slate-900/50 rounded-xl p-6 h-full backdrop-blur-sm">
          <div class="flex items-center justify-between mb-4">
            <label for="userInput" class="text-sm font-semibold text-slate-200 flex items-center gap-2">
              <svg class="w-4 h-4 text-brand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                </path>
              </svg>
              Job Description
            </label>
            <div id="usageInfo"
              class="text-xs font-medium px-2 py-1 rounded bg-white/5 text-slate-400 border border-white/5">
              <span id="freeUsageText">Free: 3/day</span>
              <span id="proUsageText" class="hidden text-brand-400">Pro: Unlimited</span>
            </div>
          </div>
          <textarea id="userInput"
            class="w-full h-80 bg-slate-800/50 border border-slate-700 rounded-lg p-4 text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500/50 transition-all resize-none text-sm leading-relaxed custom-scrollbar"
            placeholder="Paste the job description here... e.g. 'We are looking for a Senior Product Designer with 5 years of experience...'"></textarea>
          <div class="mt-6">
            <button id="submitBtn"
              class="group w-full relative overflow-hidden bg-gradient-to-r from-brand-600 to-brand-500 hover:from-brand-500 hover:to-brand-400 text-white font-semibold py-3.5 px-6 rounded-lg transition-all duration-300 shadow-lg shadow-brand-500/25 disabled:opacity-70 disabled:cursor-not-allowed">
              <span class="relative z-10 flex items-center justify-center gap-2" id="btnText">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z">
                  </path>
                </svg>
                Generate Cover Letter
              </span>
              <div
                class="absolute inset-0 bg-white/20 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700">
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- Output Panel -->
      <div class="glass rounded-2xl p-1 shadow-2xl transition-all duration-300 animate-fade-in"
        style="animation-delay: 0.2s;">
        <div class="bg-slate-900/50 rounded-xl p-6 h-full min-h-[480px] backdrop-blur-sm relative flex flex-col">
          <div class="flex items-center justify-between mb-4">
            <label class="text-sm font-semibold text-slate-200 flex items-center gap-2">
              <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                </path>
              </svg>
              Result
            </label>
            <button id="copyBtn"
              class="hidden text-xs font-medium px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-slate-300 hover:text-white transition-colors border border-white/5 flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                </path>
              </svg>
              Copy Text
            </button>
          </div>

          <!-- Empty State -->
          <div id="emptyState"
            class="flex-1 flex flex-col items-center justify-center text-center p-8 border-2 border-dashed border-slate-700/50 rounded-lg">
            <div class="w-16 h-16 bg-slate-800/50 rounded-full flex items-center justify-center mb-4">
              <svg class="w-8 h-8 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                </path>
              </svg>
            </div>
            <h3 class="text-slate-300 font-medium mb-1">Ready to Generate</h3>
            <p class="text-slate-500 text-sm max-w-xs">Paste your job description on the left and hit generate to see
              the magic happen.</p>
          </div>

          <!-- Loading State -->
          <div id="loadingState" class="hidden flex-1 flex flex-col items-center justify-center">
            <div class="relative w-16 h-16 mb-4">
              <div class="absolute top-0 left-0 w-full h-full border-4 border-slate-700 rounded-full"></div>
              <div
                class="absolute top-0 left-0 w-full h-full border-4 border-brand-500 rounded-full border-t-transparent animate-spin">
              </div>
            </div>
            <p class="text-slate-300 font-medium animate-pulse">Analyzing Job Requirements...</p>
          </div>

          <!-- Output Text -->
          <textarea id="output" readonly
            class="hidden w-full flex-1 bg-transparent border-none focus:ring-0 text-slate-300 text-sm leading-relaxed resize-none custom-scrollbar"></textarea>
        </div>
      </div>
    </div>

    <!-- Pricing Section -->
    <div id="pricing" class="mt-32 mb-16">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-white mb-4">Simple, Transparent Pricing</h2>
        <p class="text-slate-400">Unlock unlimited power. Cancel anytime.</p>
      </div>

      <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
        <!-- Monthly -->
        <div class="glass rounded-2xl p-8 hover:bg-white/5 transition-all duration-300 border border-white/5">
          <h3 class="text-xl font-semibold text-white mb-2">Pro Monthly</h3>
          <div class="flex items-baseline gap-1 mb-6">
            <span class="text-4xl font-bold text-white">$9.9</span>
            <span class="text-slate-400">/mo</span>
          </div>
          <ul class="space-y-4 mb-8 text-slate-300 text-sm">
            <li class="flex items-center gap-3">
              <svg class="w-5 h-5 text-brand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              Unlimited generations
            </li>
            <li class="flex items-center gap-3">
              <svg class="w-5 h-5 text-brand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              All 10 languages
            </li>
            <li class="flex items-center gap-3">
              <svg class="w-5 h-5 text-brand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              Priority support
            </li>
          </ul>
          <button id="subscribeMonthly"
            class="w-full py-3 rounded-lg border border-slate-600 text-white font-medium hover:bg-white hover:text-slate-900 transition-all duration-300">
            Subscribe Monthly
          </button>
        </div>

        <!-- Yearly -->
        <div class="glass rounded-2xl p-1 relative">
          <div
            class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-brand-500 to-purple-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">
            BEST VALUE
          </div>
          <div class="bg-slate-900/80 rounded-xl p-7 h-full backdrop-blur-sm">
            <h3 class="text-xl font-semibold text-white mb-2">Pro Yearly</h3>
            <div class="flex items-baseline gap-1 mb-2">
              <span class="text-4xl font-bold text-white">$79</span>
              <span class="text-slate-400">/yr</span>
            </div>
            <p class="text-xs text-brand-400 font-medium mb-6">Save 33% ($39.80)</p>

            <ul class="space-y-4 mb-8 text-slate-300 text-sm">
              <li class="flex items-center gap-3">
                <svg class="w-5 h-5 text-brand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Unlimited generations
              </li>
              <li class="flex items-center gap-3">
                <svg class="w-5 h-5 text-brand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                All 10 languages
              </li>
              <li class="flex items-center gap-3">
                <svg class="w-5 h-5 text-brand-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Priority support
              </li>
            </ul>
            <button id="subscribeYearly"
              class="w-full py-3 rounded-lg bg-white text-slate-900 font-bold hover:bg-brand-50 transition-all duration-300 shadow-lg shadow-brand-500/20">
              Subscribe Yearly
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-slate-500 text-sm py-8 border-t border-white/5">
      <p>&copy; 2024 YourCoverAI. All rights reserved.</p>
    </footer>

  </main>

  <script>
    // API Configuration
    // Use relative paths since Worker is bound to /api/*
    const API_BASE_URL = '';

    // Language configuration
    const SUPPORTED_LANGUAGES = {
      en: 'English',
      zh: '中文',
      es: 'Español',
      fr: 'Français',
      de: 'Deutsch',
      pt: 'Português',
      ja: '日本語',
      ko: '한국어',
      ar: 'العربية',
      hi: 'हिन्दी'
    };

    // Current language and translations
    let currentLang = 'en';
    let translations = {};

    // DOM elements
    const userInput = document.getElementById('userInput');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const output = document.getElementById('output');
    const copyBtn = document.getElementById('copyBtn');
    const loadingState = document.getElementById('loadingState');
    const emptyState = document.getElementById('emptyState');
    const langBtn = document.getElementById('langBtn');
    const langBtnText = document.getElementById('langBtnText');
    const langDropdown = document.getElementById('langDropdown'); // Note: Logic slightly changed for hover/click
    const langOptions = document.querySelectorAll('.lang-option');

    // Detect browser language
    function detectLanguage() {
      const savedLang = localStorage.getItem('yourcoverai_lang');
      if (savedLang && SUPPORTED_LANGUAGES[savedLang]) {
        return savedLang;
      }

      const browserLang = navigator.language || navigator.userLanguage;
      const langCode = browserLang.split('-')[0].toLowerCase();

      if (SUPPORTED_LANGUAGES[langCode]) {
        return langCode;
      }

      return 'en'; // Default to English
    }

    // Load language pack
    async function loadLanguage(lang) {
      try {
        const response = await fetch(`/i18n/${lang}.json`);
        if (!response.ok) {
          throw new Error(`Failed to load language pack: ${lang}`);
        }
        translations = await response.json();
        currentLang = lang;
        localStorage.setItem('yourcoverai_lang', lang);
        updateUI();
      } catch (error) {
        console.error('Error loading language pack:', error);
        // Fallback to English if language pack fails to load
        if (lang !== 'en') {
          await loadLanguage('en');
        }
      }
    }

    // Update UI with current translations
    function updateUI() {
      if (!translations || Object.keys(translations).length === 0) {
        return;
      }

      // Update basic text elements if they exist in translations
      // Note: Since we changed the UI structure, some IDs might need checking or we rely on defaults
      // For this redesign, we keep it simple and assume English default for static text unless strict i18n is required immediately.
      // But we will update the dynamic parts.

      if (translations.generate_btn) {
        // Only update text part, keep icon
        const icon = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>`;
        btnText.innerHTML = `${icon} ${translations.generate_btn}`;
      }

      // Update language button
      langBtnText.textContent = currentLang.toUpperCase();

      // Update HTML lang attribute for RTL languages
      if (currentLang === 'ar' || currentLang === 'he') {
        document.documentElement.setAttribute('dir', 'rtl');
      } else {
        document.documentElement.setAttribute('dir', 'ltr');
      }
      document.documentElement.setAttribute('lang', currentLang);
    }

    // Language switcher interaction (Hover based in CSS, but keeping click for mobile)
    langBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      // Toggle visibility class if we were using JS for toggle, but we used CSS group-hover. 
      // For mobile support, we might want to toggle a class.
      // Let's add a simple toggle for click support
      langDropdown.classList.toggle('!opacity-100');
      langDropdown.classList.toggle('!visible');
    });

    langOptions.forEach(option => {
      option.addEventListener('click', async (e) => {
        e.stopPropagation();
        const selectedLang = option.dataset.lang;
        if (selectedLang !== currentLang) {
          await loadLanguage(selectedLang);
        }
        langDropdown.classList.remove('!opacity-100');
        langDropdown.classList.remove('!visible');
      });
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!langBtn.contains(e.target) && !langDropdown.contains(e.target)) {
        langDropdown.classList.remove('!opacity-100');
        langDropdown.classList.remove('!visible');
      }
    });

    // Check license status on load
    function checkLicenseStatus() {
      const license = localStorage.getItem('yc_license');
      const freeUsageText = document.getElementById('freeUsageText');
      const proUsageText = document.getElementById('proUsageText');

      if (license) {
        freeUsageText.classList.add('hidden');
        proUsageText.classList.remove('hidden');
      } else {
        freeUsageText.classList.remove('hidden');
        proUsageText.classList.add('hidden');
      }
    }

    // Initialize with detected language
    (async () => {
      const detectedLang = detectLanguage();
      await loadLanguage(detectedLang);
      checkLicenseStatus();
    })();

    // Generate cover letter
    submitBtn.addEventListener('click', async () => {
      const input = userInput.value.trim();

      if (!input) {
        alert('Please enter a job description');
        return;
      }

      // Disable button and show loading
      submitBtn.disabled = true;
      const originalBtnContent = btnText.innerHTML;
      btnText.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Generating...`;

      loadingState.classList.remove('hidden');
      output.classList.add('hidden');
      emptyState.classList.add('hidden');
      copyBtn.classList.add('hidden');

      // Get license key from localStorage
      const license = localStorage.getItem('yc_license');

      try {
        const headers = {
          'Content-Type': 'application/json'
        };

        // Add license key to headers if available
        if (license) {
          headers['x-license-key'] = license;
        }

        let res;
        try {
          res = await fetch(`${API_BASE_URL}/api/generate`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify({
              input,
              target_language: currentLang
            })
          });
        } catch (networkError) {
          throw new Error(`Network error: Unable to connect to server.`);
        }

        let data;
        try {
          data = await res.json();
        } catch (parseError) {
          const text = await res.text();
          throw new Error(`Server error (${res.status}): ${text || res.statusText}`);
        }

        if (!res.ok) {
          const errorMsg = data.error || data.message || `HTTP ${res.status}`;
          throw new Error(errorMsg);
        }

        if (data.error) {
          if (data.error === 'free_limit_reached') {
            alert("Free limit reached! Please upgrade to Pro for unlimited generations.");
            document.getElementById('pricing').scrollIntoView({ behavior: 'smooth' });
            throw new Error(data.message || 'Free limit reached');
          }
          throw new Error(data.error);
        }

        const coverLetter = data.output || 'No output generated';

        // Show output
        output.value = coverLetter;
        output.classList.remove('hidden');
        loadingState.classList.add('hidden');
        copyBtn.classList.remove('hidden');

        // Scroll output into view
        output.scrollTop = 0;

      } catch (error) {
        console.error('Generate error:', error);
        alert(`Error: ${error.message}`);
        loadingState.classList.add('hidden');
        emptyState.classList.remove('hidden');
      } finally {
        // Re-enable button
        submitBtn.disabled = false;
        btnText.innerHTML = originalBtnContent;
      }
    });

    // Copy button functionality
    copyBtn.addEventListener('click', async () => {
      const text = output.value;
      if (!text) return;

      try {
        await navigator.clipboard.writeText(text);
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML = `<svg class="w-3.5 h-3.5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!`;
        setTimeout(() => {
          copyBtn.innerHTML = originalText;
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });

    // Handle Subscribe buttons
    async function createCheckoutSession(plan) {
      const button = plan === 'monthly'
        ? document.getElementById('subscribeMonthly')
        : document.getElementById('subscribeYearly');

      const originalText = button.textContent;
      button.disabled = true;
      button.textContent = 'Processing...';

      try {
        const response = await fetch(`${API_BASE_URL}/api/create-checkout-session`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ plan })
        });

        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          throw new Error('No checkout URL received');
        }
      } catch (error) {
        console.error('Checkout error:', error);
        alert('Failed to initiate checkout. Please try again.');
        button.disabled = false;
        button.textContent = originalText;
      }
    }

    document.getElementById('subscribeMonthly').addEventListener('click', () => createCheckoutSession('monthly'));
    document.getElementById('subscribeYearly').addEventListener('click', () => createCheckoutSession('yearly'));
  </script>
</body>

</html>